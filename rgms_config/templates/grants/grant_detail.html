{% extends 'base.html' %}

{% block content %}
<div class="container">
    <div class="header-flex">
        <h2 class="hero-title">Grant Details: {{ proposal.title }}</h2>
        
        <a href="{% url 'researcher_dashboard' %}" class="btn" 
           style="color: white; border: 1px solid rgba(255,255,255,0.4); background: rgba(0,0,0,0.1);">
           &larr; Back
        </a>
    </div>

    <div class="card">
        <h3>Overview</h3>
        <div class="info-grid">
            <div><strong>Grant ID:</strong> #{{ grant.grantID }}</div>
            <div><strong>Allocated:</strong> ${{ grant.totalAllocatedAmount }}</div>
            <div><strong>Spent:</strong> ${{ budget.totalSpent }}</div>
            <div>
                <a href="{% url 'submit_report' proposal.proposalID %}" class="btn btn-primary">Submit Report</a>
            </div>
        </div>

        <h3>Budget Usage</h3>
        <div class="progress-container">
            <div class="progress-fill {% if usage_percent > 90 %}bg-danger{% else %}bg-success{% endif %}" 
                 style="width: {{ usage_percent }}%;">  
                 {{ usage_percent }}%
            </div>
        </div>
    </div>

    <div class="card" style="margin-top: 20px;">
        <h3>Report History</h3>
        <ul style="list-style: none; padding: 0;">
            {% for report in reports %}
                <li style="margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                    <div style="font-size: 0.85rem; color: #6b7280; margin-bottom: 5px;">
                        {{ report.submissionDate }}
                    </div>

                    {% if "URGENT INTERVENTION" in report.content or "HOD INTERVENTION" in report.content %}
                        <div style="
                            background-color: #fef2f2; 
                            border-left: 4px solid #ef4444; 
                            color: #b91c1c; 
                            padding: 10px; 
                            border-radius: 4px;
                        ">
                            <strong>⚠ ACTION REQUIRED:</strong><br>
                            
                            <div style="font-weight: 800; color: #7f1d1d; margin-top: 5px; margin-bottom: 2px;">
                                {{ report.milestonesAchieved }}
                            </div>
                            
                            <div style="font-size: 0.95rem;">{{ report.content }}</div>
                        </div>

                    {% elif "HOD FEEDBACK" in report.content %}
                        <div style="
                            background-color: #eff6ff; 
                            border-left: 4px solid #3b82f6; 
                            color: #1d4ed8; 
                            padding: 10px; 
                            border-radius: 4px;
                        ">
                            <strong>ℹ HOD Update:</strong><br>
                            
                            <div style="font-weight: 800; color: #1e3a8a; margin-top: 5px; margin-bottom: 2px;">
                                {{ report.milestonesAchieved }}
                            </div>
                            
                            <div style="font-size: 0.95rem;">{{ report.content }}</div>
                        </div>

                    {% else %}
                        <div>
                            <span style="color: #4b5563; font-weight: 600;">Milestones:</span> 
                            <span style="color: #111827; font-weight: 600;">{{ report.milestonesAchieved }}</span>
                            <br>
                            <span style="color: #374151; display: block; margin-top: 4px;">
                                {{ report.content }}
                            </span>
                        </div>
                    {% endif %}
                </li>
            {% empty %}
                <li style="color: grey;">No reports found.</li>
            {% endfor %}
        </ul>
    </div>
</div>
{% endblock %}