{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container">
    
    <div class="header-flex dashboard-header">
        <div class="header-text">
            <h1>Researcher Dashboard</h1>
            <p>Track your proposals, active grants, and deadlines.</p>
        </div>
        <div class="header-actions">
            <a href="{% url 'submit_proposal' %}" class="btn btn-white-glass">
                <span class="plus-icon">+</span> New Proposal
            </a>
        </div>
    </div>

    <div class="card no-padding dashboard-card">
        <div class="card-header flex-header">
            <span>Portfolio</span>
        </div>
        
        <div class="card-body-table">
            {% if proposals %}
            <table class="modern-table">
                <thead>
                    <tr>
                        <th class="text-center" width="20%">Project Title</th>
                        <th class="text-center" width="20%">Submitted</th>
                        <th class="text-center" width="20%">Ver.</th>
                        <th class="text-center" width="20%">Status</th>
                        <th class="text-center" width="20%">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for proposal in proposals %}
                    <tr class="table-row-animate">
                        <td class="text-center">
                            <div class="project-info centered-info">
                                <span class="project-title">{{ proposal.title }}</span>
                                {% if proposal.grant %}
                                    <small class="grant-id">#{{ proposal.grant.grantID }}</small>
                                {% endif %}
                            </div>
                        </td>

                        <td class="text-center text-muted">
                            {{ proposal.submissionDate|date:"M d, Y" }}
                        </td>

                        <td class="text-center">
                            <span class="ver-tag">v{{ proposal.version|floatformat:1 }}</span>
                        </td>

                        <td class="text-center">
                            {% if proposal.status == 'Approved' or proposal.status == 'On Track' %}
                                <span class="badge badge-success-soft">
                                    <i class="status-icon">‚úÖ</i> {{ proposal.status }}
                                </span>
                            {% elif proposal.status == 'Needs Intervention' %}
                                <span class="badge badge-danger-soft pulse-animation">
                                    <i class="status-icon">‚ö†Ô∏è</i> Intervention
                                </span>
                            {% elif proposal.status == 'Rejected' %}
                                <span class="badge badge-danger-soft pulse-animation">
                                    <i class="status-icon">‚ùå</i> Rejected
                                </span>
                            {% elif proposal.status == 'Pending' %}
                                <span class="badge badge-warning-soft">
                                    <i class="status-icon">‚è≥</i> Pending
                                </span>
                            {% elif proposal.status == 'Review Complete' %}
                                <span class="badge badge-info-soft">
                                    <i class="status-icon">üìã</i> Reviewed
                                </span>
                            {% else %}
                                <span class="badge badge-grey-soft">
                                    {{ proposal.status }}
                                </span>
                            {% endif %}
                        </td>

                        <td class="text-center">
                            {% if proposal.status == 'Approved' or proposal.status == 'Needs Intervention' or proposal.status == 'On Track' %}
                                <a href="{% url 'grant_detail' proposal.proposalID %}" class="btn btn-sm btn-primary-gradient shadow-hover">
                                    View Grant
                                </a>
                            {% elif proposal.status == 'Pending' or proposal.status == 'Draft' or proposal.status == 'Rejected' %}
                                <a href="{% url 'resubmit_proposal' proposal.proposalID %}" class="btn btn-sm btn-outline-secondary">
                                    Resubmit
                                </a>
                            {% else %}
                                <span class="status-text-muted">Awaiting HOD Decision</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="empty-state-container">
                <div class="empty-state-content">
                    <div class="empty-icon-circle">
                        <span class="empty-icon-emoji">üöÄ</span>
                    </div>
                    
                    <h3>Ready to Launch Your Research?</h3>
                    <p>You haven't submitted any proposals yet. Start your journey by creating your first grant application today.</p>
                    
                    <a href="{% url 'submit_proposal' %}" class="btn btn-primary-gradient btn-lg shadow-hover mt-3">
                        + Create New Proposal
                    </a>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}