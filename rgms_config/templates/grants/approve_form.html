{% extends 'base.html' %}

{% block content %}
<div class="allocation-card card">
    <h2>Approve Proposal: {{ proposal.title }}</h2>

    {% if error_message %}
        <div class="alert alert-error">
            {{ error_message }}
        </div>
    {% endif %}

    <div class="budget-status-box">
        <h4>Budget Overview</h4>
        <p>Your Department Balance: <strong>${{ hod_budget }}</strong></p>
        <p>Researcher Requested: <strong>$<span id="requested-val">{{ proposal.requested_amount }}</span></strong></p>
    </div>

    <form method="post" onsubmit="return confirmAllocation()">
        {% csrf_token %}
        
        <div class="form-group">
            <label>Allocation Amount ($):</label>
            <input type="number" name="amount" id="allocation-input" 
                   value="{{ proposal.requested_amount }}" step="0.01" class="form-input-full">
        </div>

        <div class="date-grid">
            <div>
                <label>Start Date:</label>
                <input type="date" name="start_date" class="form-input-full" required>
            </div>
            <div>
                <label>End Date:</label>
                <input type="date" name="end_date" class="form-input-full" required>
            </div>
        </div>

        <button type="submit" class="btn btn-confirm">Confirm & Approve</button>
        <a href="{% url 'hod_dashboard' %}" class="btn btn-cancel">Cancel</a>
    </form>
</div>

<script>
function confirmAllocation() {
    // Get values as numbers
    var requested = parseFloat(document.getElementById('requested-val').innerText);
    var allocated = parseFloat(document.getElementById('allocation-input').value);

    // Check if allocated is higher than requested
    if (allocated > requested) {
        return confirm("WARNING: You are allocating $" + allocated + 
                       ", which is MORE than the requested $" + requested + 
                       ".\n\nAre you sure you want to proceed?");
    }
    return true; 
}
</script>
{% endblock %}